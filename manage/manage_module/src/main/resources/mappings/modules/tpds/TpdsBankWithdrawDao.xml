<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heepay.manage.modules.tpds.dao.TpdsBankWithdrawDao">
    
	<sql id="tpdsBankWithdrawColumns">
		a.cus_id AS "cusId",
		a.business_seq_no AS "businessSeqNo",
		a.business_order_no AS "businessOrderNo",
		a.r_type AS "raType",
		a.entrustflag AS "entrustflag",
		a.oder_no AS "oderNo",
		a.debit_account_no AS "debitAccountNo",
		a.cebit_account_no AS "cebitAccountNo",
		a.currency AS "currency",
		a.amount AS "amount",
		a.other_amounttype AS "otherAmounttype",
		a.other_amount AS "otherAmount",
		a.pay_type AS "payType",
		a.busi_branch_no AS "busiBranchNo",
		a.bank_account_no AS "bankAccountNo",
		a.sec_bankacc_no AS "secBankaccNo",
		a.note AS "note",
		a.create_time AS "createTime"
	</sql>

	<select id="findList" resultType="TpdsBankWithdraw">
		SELECT 
			<include refid="tpdsBankWithdrawColumns"/>
		FROM tpds_bank_withdraw a
		<where>
			<!-- 业务流水号-->
			<if test="businessSeqNo != null and businessSeqNo != ''">
				AND business_seq_no = #{businessSeqNo}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.cus_id DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findCountAndSum" resultType="map" parameterType="TpdsBankWithdraw">
		SELECT
        (CASE WHEN SUM(a.amount) IS NULL THEN 0 ELSE SUM(a.amount) END) AS "totalAmount"
		FROM tpds_bank_withdraw a
		<where>
            <!-- 业务流水号-->
            <if test="businessSeqNo != null and businessSeqNo != ''">
                AND business_seq_no = #{businessSeqNo}
            </if>
		</where>		
	</select>
</mapper>